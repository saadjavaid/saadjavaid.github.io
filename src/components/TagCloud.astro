---
import { getCollection } from "astro:content";
import { slugify } from "../utils/utils";

const allPosts = await getCollection("post");
const allTags = allPosts.map((post) => post.data.tags).flat();

const processedTags = allTags.reduce((acc, tag) => {
  const value = acc[tag] || 0;
  const pTags = {
    ...acc,
    [tag]: value + 1,
  };

  const sortedTags = Object.fromEntries(
    Object.entries(pTags).sort((a, b) => b[1] - a[1])
  );

  return sortedTags;
}, {});

const { showCount, displayNumber } = Astro.props;
---

<div class="flex flex-wrap gap-2 justify-center">
  {Object.entries(processedTags)
    .map(([key, val]) => (
      <a 
        class="inline-block px-3 py-1 text-sm bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900 hover:text-blue-700 dark:hover:text-blue-300 transition-colors duration-200 no-underline"
        href={`/tags/${slugify(key)}/`}
      >
        {key}
        {showCount && <span class="text-xs opacity-75 ml-1">({val})</span>}
      </a>
    ))
    .slice(0, displayNumber)
  }
  {displayNumber < 999 && (
    <a 
      href="/tags/" 
      class="inline-block px-3 py-1 text-sm bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors duration-200 no-underline"
    >
      All Tags â†’
    </a>
  )}
</div>